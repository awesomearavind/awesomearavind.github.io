<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <title>ARC-NET</title>

    <link rel="stylesheet" href="style2.css" />
    <style>
        html {
            height: 100%;
        }
        
        body {
            padding: 0px;
            height: 100%;
            margin: 0px;
            font-family: Helvetica, Arial;
        }
        
        #tools button {
            background-color: rgb(0, 0, 0);
            margin: 0px;
            padding-top: 1vw;
            padding-bottom: 1vw;
            width: 100vw;
            font-size: 2vw;
            font-family: "ubuntu";
            color: white;
            border: none;
        }
    </style>

    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript" src="http://www.geocodezip.com/scripts/v3_epoly.js"></script>
    <script type="text/javascript">
        var map;
        var directionDisplay;
        var directionsService;
        var stepDisplay;

        var position;
        var marker = [];
        var polyline = [];
        var poly2 = [];
        var poly = null;
        var startLocation = [];
        var endLocation = [];
        var timerHandle = [];


        var speed = 0.000005,
            wait = 1;
        var infowindow = null;

        var myPano;
        var panoClient;
        var nextPanoId;

        var startLoc = new Array();
        startLoc[0] = 'Indian Institute of Science Education and Research, Thiruvananthapuram';
        startLoc[1] = 'Indian Institute of Science Education and Research, Thiruvananthapuram';
        startLoc[2] = 'Indian Institute of Science Education and Research, Thiruvananthapuram';
        startLoc[3] = 'Indian Institute of Science Education and Research, Thiruvananthapuram';

        var endLoc = new Array();
        endLoc[0] = 'Thakarapparambu, Kerala';
        endLoc[1] = 'Agasthya Muni Temple, Kerala';
        endLoc[2] = 'Vazhvanthol Waterfalls, Bonacaud';
        endLoc[3] = 'Sreekariyam, Thiruvananthapuram, Kerala';


        var Colors = ["#FF0000", "#00FF00", "#0000FF"];


        function initialize() {

            infowindow = new google.maps.InfoWindow({
                size: new google.maps.Size(150, 50)
            });

            var myOptions = {
                zoom: 16,
                mapTypeId: google.maps.MapTypeId.SATELLITE
            }
            map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

            address = 'Indian Institute of Science Education and Research, Thiruvananthapuram'
            geocoder = new google.maps.Geocoder();
            geocoder.geocode({
                'address': address
            }, function(results, status) {
                map.fitBounds(results[0].geometry.viewport);

            });

        }


        function createMarker(latlng, label, html) {

            var contentString = '<b>' + label + '</b><br>' + html;
            var marker = new google.maps.Marker({
                position: latlng,
                map: map,
                title: label,
                zIndex: Math.round(latlng.lat() * -100000) << 5
            });
            marker.myname = label;


            google.maps.event.addListener(marker, 'click', function() {
                infowindow.setContent(contentString);
                infowindow.open(map, marker);
            });
            return marker;
        }

        function setRoutes() {

            var directionsDisplay = new Array();

            for (var i = 0; i < startLoc.length; i++) {

                var rendererOptions = {
                    map: map,
                    suppressMarkers: true,
                    preserveViewport: true
                }
                directionsService = new google.maps.DirectionsService();

                var travelMode = google.maps.DirectionsTravelMode.DRIVING;

                var request = {
                    origin: startLoc[i],
                    destination: endLoc[i],
                    travelMode: travelMode
                };

                directionsService.route(request, makeRouteCallback(i, directionsDisplay[i]));

            }


            function makeRouteCallback(routeNum, disp) {
                if (polyline[routeNum] && (polyline[routeNum].getMap() != null)) {
                    startAnimation(routeNum);
                    return;
                }
                return function(response, status) {

                    if (status == google.maps.DirectionsStatus.OK) {

                        var bounds = new google.maps.LatLngBounds();
                        var route = response.routes[0];
                        startLocation[routeNum] = new Object();
                        endLocation[routeNum] = new Object();


                        polyline[routeNum] = new google.maps.Polyline({
                            path: [],
                            strokeColor: '#FFFF00',
                            strokeWeight: 3
                        });

                        poly2[routeNum] = new google.maps.Polyline({
                            path: [],
                            strokeColor: '#FFFF00',
                            strokeWeight: 3
                        });



                        var path = response.routes[0].overview_path;
                        var legs = response.routes[0].legs;


                        disp = new google.maps.DirectionsRenderer(rendererOptions);
                        disp.setMap(map);
                        disp.setDirections(response);



                        for (i = 0; i < legs.length; i++) {
                            if (i == 0) {
                                startLocation[routeNum].latlng = legs[i].start_location;
                                startLocation[routeNum].address = legs[i].start_address;

                                marker[routeNum] = createMarker(legs[i].start_location, "start", legs[i].start_address, "green");
                            }
                            endLocation[routeNum].latlng = legs[i].end_location;
                            endLocation[routeNum].address = legs[i].end_address;
                            var steps = legs[i].steps;

                            for (j = 0; j < steps.length; j++) {
                                var nextSegment = steps[j].path;
                                var nextSegment = steps[j].path;

                                for (k = 0; k < nextSegment.length; k++) {
                                    polyline[routeNum].getPath().push(nextSegment[k]);

                                }

                            }
                        }

                    }

                    polyline[routeNum].setMap(map);

                    startAnimation(routeNum);

                }
            }

        }

        var lastVertex = 1;
        var stepnum = 0;
        var step = 5;
        var tick = 1000;
        var eol = [];

        function updatePoly(i, d) {

            if (poly2[i].getPath().getLength() > 20) {
                poly2[i] = new google.maps.Polyline([polyline[i].getPath().getAt(lastVertex - 1)]);

            }

            if (polyline[i].GetIndexAtDistance(d) < lastVertex + 2) {
                if (poly2[i].getPath().getLength() > 1) {
                    poly2[i].getPath().removeAt(poly2[i].getPath().getLength() - 1)
                }
                poly2[i].getPath().insertAt(poly2[i].getPath().getLength(), polyline[i].GetPointAtDistance(d));
            } else {
                poly2[i].getPath().insertAt(poly2[i].getPath().getLength(), endLocation[i].latlng);
            }
        }


        function animate(index, d) {
            if (d > eol[index]) {

                marker[index].setPosition(endLocation[index].latlng);
                return;
            }
            var p = polyline[index].GetPointAtDistance(d);


            marker[index].setPosition(p);
            updatePoly(index, d);
            timerHandle[index] = setTimeout("animate(" + index + "," + (d + step) + ")", tick);
        }



        function startAnimation(index) {
            if (timerHandle[index]) clearTimeout(timerHandle[index]);
            eol[index] = polyline[index].Distance();
            map.setCenter(polyline[index].getPath().getAt(0));

            poly2[index] = new google.maps.Polyline({
                path: [polyline[index].getPath().getAt(0)],
                strokeColor: "#FFFF00",
                strokeWeight: 3
            });

            timerHandle[index] = setTimeout("animate(" + index + ",50)", 2000);
        }
    </script>
</head>

<body onload="initialize()">
    <div id="overlay">
        <script type="text/javascript" src="load.js"></script>
        <ul>

            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>

        </ul>
    </div>
    <div id="tools">

        <button onclick="setRoutes();">START</button>

    </div>

    <div id="map_canvas" style="width:100%;height:100%;"></div>
    <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
    </script>
    <script type="text/javascript">
        _uacct = "UA-162157-1";
        urchinTracker();
    </script>
</body>

</html>
